"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./common/vendor.js"),t=require("./utils/rsa.js"),n=require("./utils/update.js"),o=require("./config.js");Math;const a={__name:"App",setup(a){e.index.getStorageSync("token");const i=e.index.getStorageSync("password"),r=e.index.getStorageSync("username"),s=e.index.getStorageSync("autoLogin"),{checkForUpdate:d}=n.useUpdateManager();e.onLaunch((()=>{s?c():(e.index.redirectTo({url:"/pages/login/login"}),console.log("No token found")),d()})),e.onMounted((()=>{l()}));const c=async()=>{try{const n=e.index.getStorageSync("publicKey"),a=t.rsaEncrypt(i,n),s=await e.index.request({url:o.BASE_URL+"/login",method:"POST",data:{username:r,password:a}});if(200===s.data.code){const t=s.data.token;e.index.setStorageSync("token",t),e.index.switchTab({url:"/pages/index/index"})}else e.index.removeStorageSync("token"),e.index.redirectTo({url:"/pages/login/login"})}catch(n){e.index.removeStorageSync("token"),e.index.redirectTo({url:"/pages/login/login"})}},u=e.ref(null),g=e.ref(null),l=()=>{e.index.getLocation({type:"wgs84",success(t){u.value=t.latitude,g.value=t.longitude;e.index.createWebViewContext("myWebView").postMessage({data:{latitude:t.latitude,longitude:t.longitude}})},fail(){e.index.showToast({title:"获取位置失败",icon:"none"})}})};return()=>{}}};function i(){return{app:e.createSSRApp(a)}}i().app.mount("#app"),exports.createApp=i;
