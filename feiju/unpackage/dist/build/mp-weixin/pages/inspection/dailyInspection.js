"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/apis.js"),n=require("../../config.js");if(!Array){(e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-popup-message"))()}Math||((()=>"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js")+(()=>"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js"))();const t={__name:"dailyInspection",setup(t){const i=e.ref([null]),s=e.ref(""),u=e.ref([]),l=e.ref([]);e.ref([]);const p=n.imgRequestHeader.URL,r=e.ref(""),c=e.ref([]),d=e.ref([]);e.ref([]);const m=e.ref(""),v=e.ref("");e.onLoad((e=>{s.value=e.id,f()}));const f=async()=>{if(s.value){let e=await o.apiGetInspectionById(s.value);u.value=e.data,l.value=e.data.inspectionItemList,c.value.length=l.value.length,c.value.fill(!1),d.value.length=l.value.length}else e.index.showModal({content:"未获取ID",showCancel:!1})},h=async()=>{try{if(c.value.every(Boolean)){200===(await o.apiUpdateInspection(u.value)).code?(v.value.open(),setTimeout((()=>{e.index.navigateBack()}),1e3)):e.index.showToast({title:"提交失败",icon:"none",duration:2e3})}else e.index.showToast({title:"请先确认检查项",icon:"none",duration:2e3})}catch(a){e.index.showToast({title:a.msg,icon:"none",duration:2e3})}};function _(e,a){l.value[e].attachmentList.splice(a,1)}const g=()=>{e.index.navigateBack()};return(o,t)=>({a:a._imports_0$4,b:e.o(g),c:e.t(u.value.sceneName),d:e.t(u.value.taskName),e:e.t(u.value.levelName),f:e.t(u.value.sceneName),g:e.f(l.value,((o,t,s)=>({a:e.t(o.name),b:e.o((e=>function(e){i.value.includes(e)||(i.value.push(e),d.value[e]?l.value[e].note=d.value[e]:l.value[e].note="",l.value[e].normal=!0,c.value[e]=!0)}(t)),o.id),c:e.o((e=>function(e){i.value.includes(e)&&(i.value=i.value.filter((a=>a!==e)),c.value[e]=!1)}(t)),o.id),d:e.f(o.attachmentList,((o,n,i)=>e.e({a:"mp4"===o.split(".").pop()},"mp4"===o.split(".").pop()?{b:e.unref(p)+o,c:e.o((e=>{return a=o,m.value.open(),void(r.value=p+a);var a}),n),d:a._imports_3$5,e:e.o((e=>_(t,n)),n)}:{f:e.unref(p)+o,g:e.o((a=>{return n=e.unref(p)+o,void e.index.previewImage({current:"",urls:[n]});var n}),n),h:a._imports_3$5,i:e.o((e=>_(t,n)),n)},{j:n}))),e:e.o((a=>(a=>{e.index.chooseMedia({count:1,mediaType:["mix"],sourceType:["album","camera"],maxDuration:60,camera:"back",success(o){e.index.uploadFile({url:n.BASE_URL+"/minio/fileUpload",filePath:o.tempFiles[0].tempFilePath,name:"file",header:{"Content-Type":"multipart/form-data"},success:e=>{try{const o=JSON.parse(e.data).msg;l.value[a].attachmentList.push(o)}catch(o){console.error("解析JSON字符串出错：",o)}},fail:e=>{console.error("上传失败",e)}})}})})(t)),o.id),f:c.value[t],g:d.value[t],h:e.o((e=>d.value[t]=e.detail.value),o.id),i:o.id,j:e.n({selected:i.value.includes(t)}),k:"3e7753dd-1-"+s+",3e7753dd-0"}))),h:a._imports_1$7,i:a._imports_2$8,j:a._imports_4$5,k:e.p({"title-border":"none",border:!1}),l:e.p({accordion:!0}),m:r.value,n:e.sr(m,"3e7753dd-2",{k:"popup"}),o:e.p({type:"center"}),p:e.o(h),q:e.p({type:"success",message:"提交成功",duration:1e3}),r:e.sr(v,"3e7753dd-3",{k:"updatePopup"}),s:e.p({type:"message"})})}},i=e._export_sfc(t,[["__scopeId","data-v-3e7753dd"]]);wx.createPage(i);
