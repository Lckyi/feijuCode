"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),n=require("../../config.js");if(!Array){e.resolveComponent("uni-popup")()}Math;const l={__name:"inspection",setup(l){const o=e.ref("unfinish"),i=e.ref("view1"),s=e.ref(null),r=e.ref(null),u=e.ref(null),v=e.ref(""),c=e.ref(!1),d=e.ref([]),p=e.ref([]);let f=1,g=1;const h=e.ref("All");let D=e.ref("全部"),m=e.ref(0);const S=e.ref([]),_=e.ref([]),b=e.ref(null),w=e.ref(""),x=e.ref(""),y=e.ref(""),I=e.reactive({startDate:"",endDate:""});e.onShow((()=>{"unfinish"===o.value&&(c.value=!1,g=1,p.value="",$())}));const k=async()=>{c.value||("finish"===o.value?f++:g++,$())},$=async()=>{const a={projectId:n.PROJECTID.globalProjectId,pageSize:10};let l;w.value&&(a.sceneId=w.value),y.value&&x.value&&(a.startDate=x.value,a.endDate=y.value),"finish"===o.value?(a.state=1,a.pageNum=f,l=await t.apiGetInspection(a),d.value=[...d.value,...l.data.records],a.pageSize>l.data.records.length&&(c.value=!0),e.index.setStorageSync("finishDataList",d.value)):(a.pageNum=g,a.state=0,l=await t.apiGetInspection(a),p.value=[...p.value,...l.data.records],a.pageSize>l.data.records.length&&(c.value=!0),e.index.setStorageSync("unFinishDataList",p.value))},N=async()=>{c.value=!1,w.value=b.value,x.value=I.startDate,y.value=I.endDate,"finish"===o.value?(d.value="",f=1):(p.value="",g=1),$(),r.value.close()};function j(e){let a=e.detail.value;D.value=S.value[a],b.value=_.value[a]}const M=e=>{const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0"),String(e.getSeconds()).padStart(2,"0"),`${a}-${t}-${n}`},T=e=>{let a,t;h.value=e;const n=new Date;switch(e){case"lastDay":const e=new Date(n.getTime()-864e5);a=M(e),t=M(n);break;case"lastMonths":const l=new Date;l.setMonth(n.getMonth()-1),a=M(l),t=M(n);break;case"All":a=t=null;default:a=t=null}I.startDate=a,I.endDate=t};let A="",C="";const P=a=>{A=a.detail.value;let t=new Date(A),n=new Date(C);t>=n&&n?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),I.startDate="",A=""):I.startDate=A},q=a=>{C=a.detail.value;let t=new Date(A);t>=new Date(C)&&t?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),I.endDate="",C=""):I.endDate=C},E=()=>{I.startDate="",I.endDate="",A="",C="",h.value="All",D.value="全部",b.value=""};function L(e,a){c.value=!1,o.value=e,i.value=a,"finish"===o.value?(d.value="",f=1):(p.value="",g=1),$()}function z(){s.value.open()}function F(){s.value.close(),r.value.open()}function G(){s.value.close(),e.index.scanCode({success:function(e){v.value=e.result,u.value.open()}})}const B=()=>{e.index.navigateBack()};return(async()=>{let e=await t.apiGetSceneName({projectId:n.PROJECTID.globalProjectId});m.value=e.data.children,m.value.forEach((e=>{e.children.length>0&&e.children.forEach((e=>{e.sceneName&&e.sceneId&&(S.value.push(e.sceneName),_.value.push(e.sceneId))}))}))})(),e.onUnload((()=>{e.index.removeStorageSync("unFinishDataList"),e.index.removeStorageSync("finishDataList")})),(t,n)=>e.e({a:a._imports_0$4,b:e.o(B),c:a._imports_1$6,d:e.o(z),e:a._imports_2$7,f:e.o(G),g:a._imports_3$4,h:e.o(F),i:e.sr(s,"be6fb665-0",{k:"popup"}),j:e.p({type:"top","border-radius":"0 0 20rpx 20rpx","mask-background-color":"rgba(0,0,0,0)"}),k:e.t(v.value),l:e.sr(u,"be6fb665-1",{k:"scanCodePopup"}),m:e.p({type:"center","border-radius":"18rpx","background-color":"#fff"}),n:"All"===h.value?1:"",o:e.o((e=>T("All"))),p:"lastDay"===h.value?1:"",q:e.o((e=>T("lastDay"))),r:"lastMonths"===h.value?1:"",s:e.o((e=>T("lastMonths"))),t:I.startDate,v:e.o((e=>I.startDate=e.detail.value)),w:e.o(P),x:I.endDate,y:e.o((e=>I.endDate=e.detail.value)),z:e.o(q),A:e.t(e.unref(D)),B:S.value,C:e.o(j),D:e.o(E),E:e.o(N),F:e.sr(r,"be6fb665-2",{k:"popupBottom"}),G:e.p({type:"bottom","border-radius":"30rpx 30rpx 0 0","background-color":"#fff"}),H:"view1"===i.value?1:"",I:e.o((e=>L("unfinish","view1"))),J:"view2"===i.value?1:"",K:e.o((e=>L("finish","view2"))),L:"unfinish"===o.value},"unfinish"===o.value?e.e({M:p.value.length>0},p.value.length>0?{N:e.f(p.value,((a,t,n)=>({a:e.t(a.sceneName),b:e.t(a.levelName),c:e.o((t=>{return n=a.id,void e.index.navigateTo({url:"/pages/inspection/dailyInspection?id="+n});var n}),a.id),d:a.id}))),O:a._imports_4$4,P:e.o(k)}:{Q:a._imports_5$1}):"finish"===o.value?e.e({S:d.value.length>0},d.value.length>0?{T:e.f(d.value,((a,t,n)=>({a:e.t(a.sceneName),b:e.t(a.completionUserName),c:e.t(a.completionTime),d:a.id,e:e.o((t=>{return n=a.id,void e.index.navigateTo({url:"/pages/inspection/inspectionCheck?id="+n});var n}),a.id)}))),U:a._imports_4$4,V:a._imports_1$2,W:e.o(k)}:{X:a._imports_5$1}):{},{R:"finish"===o.value})}},o=e._export_sfc(l,[["__scopeId","data-v-be6fb665"]]);wx.createPage(o);
