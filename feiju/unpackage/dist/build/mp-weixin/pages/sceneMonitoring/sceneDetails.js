"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),n=require("../../config.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("qiun-data-charts")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/qiun-data-charts/components/qiun-data-charts/qiun-data-charts.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const i={__name:"sceneDetails",setup(i){const o=n.imgRequestHeader.URL,u=e.ref(null);e.ref({});const r=e.ref({}),s=e.ref([]),l=e.ref(""),c=e.ref(""),d=e.ref(""),v=e.ref([]),p=e.ref([]),m=e.ref(null),f=e.ref(null),g=e.ref([]);let h=e.ref(!0);const y=e.ref(null);let w={types:"",startTime:"",endTime:"",deviceId:""};e.onLoad((e=>{l.value=e.id,d.value=e.name,_()}));const _=async()=>{let e=await t.apiGetEquipmentInfo({sceneId:l.value});s.value=e.data.deviceRecords,c.value=o+e.data.image,s.value&&s.value.forEach((e=>{D(e.deviceNumber)}))},D=async e=>{let a=await t.apiGetEquipmentData({deviceIds:e});v.value=[...v.value,...a.data]},k=async a=>{let n=await t.apiGetChart(a);p.value=n.data,function(){try{if(!p.value[0].time||!p.value[0].valueOne)return void console.error("没有图表数据");r.value="";p.value[0].valueOne;const a=function(a,t){const n=e.reactive({categories:"",data:"",showData:""}),i=e.ref([]);n.categories=a.slice(-6),n.data=t.slice(-6);for(const e in n.categories)if(n.categories.hasOwnProperty(e)){const[a,t]=n.categories[e].split(" "),o=t.slice(0,5);i.value.push(o)}return n.showData=i.value,n}(p.value[0].time,p.value[0].valueOne);r.value={categories:a.showData,series:[{name:p.value[0].typeName,data:a.data}]}}catch(a){console.error("暂无图标数据",a)}}()},q=()=>{c.value="../../static/images/changjing/icon.png"};function S(){h.value=!1}function $(){y.value.close(),h.value=!0}function b(e){h.value=!0;const a=new Date(g.value[0]),t=new Date(g.value[1]);m.value=j(a,"show"),f.value=j(t,"show"),w.startTime=g.value[0],w.endTime=g.value[1],k(w)}const j=(e,a)=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return"show"===a?`${t}/${n}/${i}`:`${t}-${n}-${i} ${o}:${u}:${r}`},C=e.ref({color:["#1890FF"],padding:[15,15,0,15],enableScroll:!1,legend:{},xAxis:{disableGrid:!0},yAxis:{gridType:"dash",dashLength:2},extra:{area:{type:"curve",opacity:.8,addLine:!0,width:2,gradient:!0,activeType:"hollow"}}}),x=()=>{e.index.navigateBack()};return(t,n)=>{var i,o,s;return e.e({a:a._imports_0$4,b:e.o(x),c:e.t(d.value),d:e.o(q),e:c.value,f:e.f(v.value,((a,t,n)=>({a:e.f(a,((a,t,n)=>e.e({a:0===t},0===t?{b:e.t(a.id)}:{},{c:e.t(a.name),d:e.t(a.value),e:e.t("null"===a.unit?"":a.unit),f:e.o((e=>function(e,a){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);m.value=j(n,"show"),f.value=j(t,"show"),w.types=e,w.startTime=j(n,""),w.endTime=j(t,""),w.deviceId=a,u.value.open(),k(w)}(a.key,a.deviceNumber)),t),g:t}))),b:t}))),g:e.t(null==(i=p.value[0])?void 0:i.typeName),h:e.p({type:"calendar",color:"#C0C4CC",size:"28"}),i:e.t(m.value),j:e.t(f.value),k:e.o(S),l:e.sr(y,"f35e4048-1,f35e4048-0",{k:"isCloseDateRange"}),m:e.o(b),n:e.o((e=>g.value=e)),o:e.p({type:"datetimerange",modelValue:g.value}),p:null==(o=p.value[0])?void 0:o.time},(null==(s=p.value[0])?void 0:s.time)?{q:e.p({type:"area",opts:C.value,chartData:r.value,ontouch:!0,canvas2d:!0})}:{r:a._imports_4$1},{s:e.sr(u,"f35e4048-0",{k:"popup"}),t:e.o($),v:e.p({type:"bottom","border-radius":"30rpx 30rpx 0 0","background-color":"#fff","safe-area":!0,"is-mask-click":e.unref(h)})})}}},o=e._export_sfc(i,[["__scopeId","data-v-f35e4048"]]);wx.createPage(o);
