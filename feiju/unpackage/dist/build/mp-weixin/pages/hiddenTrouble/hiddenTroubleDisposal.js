"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/apis.js"),i=require("../../config.js");if(!Array){(e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-popup-message"))()}Math||((()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js"))();const t={__name:"hiddenTroubleDisposal",setup(t){const u=e.ref(0),s=e.ref(""),p=e.ref(0),l=e.ref([]),n=e.ref([]),r=e.ref(""),c=e.ref(""),m=e.ref(""),v=e.reactive([{value:0,text:"处置完成"},{value:1,text:"无需处置"}]),d=e.ref(["请选择","一般隐患","严重隐患","较大隐患","重大隐患"]),f={},h=[];e.onLoad((e=>{s.value=e.id,f.id=s.value}));const _=async()=>{if(f.id)if(1===u.value){if(p.value<1)return void y("请选择隐患等级");f.level=p.value-1,f.state=3,g(f)}else{if(p.value<1)return void y("请选择隐患等级");f.state=2,f.level=p.value-1,l.value.length>0?x(l.value,(e=>{f.disposalFileList=e,g(f)})):g(f)}else y("隐患id为空")},g=async a=>{try{let i=await o.apiPutDisposal(a);200===i.code?(r.value.open(),setTimeout((()=>{e.index.navigateBack()}),1e3)):y(i.msg)}catch(i){y(i.msg)}},x=(a,o)=>{let t=0;a.forEach((u=>{(u=>{e.index.uploadFile({url:i.BASE_URL+"/minio/fileUpload",filePath:u,name:"file",header:{"Content-Type":"multipart/form-data"},success:e=>{const i=JSON.parse(e.data).msg;h.push(i),t++,t===a.length&&o(h)},fail:e=>{console.error("文件上传失败")}})})(u)}))};function k(){e.index.chooseMedia({count:1,mediaType:["mix"],sourceType:["album","camera"],maxDuration:60,camera:"back",success(e){l.value.push(e.tempFiles[0].tempFilePath),"video"===e.tempFiles[0].fileType?n.value.push(e.tempFiles[0].thumbTempFilePath):n.value.push(e.tempFiles[0].tempFilePath)}})}function b(e){l.value.splice(e,1),n.value.splice(e,1)}function y(a){e.index.showToast({title:a,icon:"none",duration:2e3})}const j=e=>{p.value=e.detail.value},F=()=>{e.index.navigateBack()};return(o,i)=>({a:a._imports_0$4,b:e.o(F),c:e.o(o.changeCheckbox),d:e.o((e=>u.value=e)),e:e.p({localdata:v,modelValue:u.value}),f:e.t(d.value[p.value]),g:a._imports_1$2,h:e.o(j),i:p.value,j:d.value,k:e.f(l.value,((o,i,t)=>e.e({a:"mp4"===o.split(".").pop()},"mp4"===o.split(".").pop()?{b:n.value[i],c:a._imports_2$10,d:e.o((e=>{return a=o,c.value.open(),void(m.value=a);var a}),i),e:a._imports_3$5,f:e.o((e=>b(i)),i)}:{g:o,h:e.o((a=>{return i=o,void e.index.previewImage({current:"",urls:[i]});var i}),i),i:a._imports_3$5,j:e.o((e=>b(i)),i)},{k:i}))),l:a._imports_4$5,m:e.o(k),n:0===u.value,o:e.o(_),p:m.value,q:e.sr(c,"760ecfd3-1",{k:"popup"}),r:e.p({type:"center"}),s:e.p({type:"success",message:"处置成功",duration:1e3}),t:e.sr(r,"760ecfd3-2",{k:"deletePopup"}),v:e.p({type:"message"})})}},u=e._export_sfc(t,[["__scopeId","data-v-760ecfd3"]]);wx.createPage(u);
