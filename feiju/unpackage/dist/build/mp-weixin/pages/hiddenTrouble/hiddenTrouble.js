"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),l=require("../../config.js");if(!Array){e.resolveComponent("uni-popup")()}Math;const s={__name:"hiddenTrouble",setup(s){const i=e.ref("全部"),o=e.ref("view1"),n=e.ref(""),u=e.ref([]),r=e.ref(!1);let v=1,d=1,c=1,p=1,m=1,g=1;const _=e.ref("All");let f=e.ref("全部"),h=e.ref(0);const D=e.ref([]),w=e.ref([]),I=e.ref(null),$=e.ref(""),b=e.ref(""),N=e.ref(""),S=e.reactive({startDate:"",endDate:""});e.onShow((()=>{r.value=!1,q(i.value)}));const y=async()=>{const a={projectId:l.PROJECTID.globalProjectId,pageSize:10};"全部"===i.value&&(a.pageNum=v),"待指派"===i.value&&(a.pageNum=d,a.state=0),"待处置"===i.value&&(a.pageNum=c,a.state=1),"待审核"===i.value&&(a.pageNum=p,a.state=4),"处置完成"===i.value&&(a.pageNum=m,a.state=2),"无需处置"===i.value&&(a.pageNum=g,a.state=3),$.value&&(a.sceneId=$.value),N.value&&b.value&&(a.startDate=b.value,a.endDate=N.value);let s=await t.apiGetHiddenDanger(a);u.value=[...u.value,...s.data.records],a.pageSize>s.data.records.length&&(r.value=!0),e.index.setStorageSync("hiddenDangerList",u.value)},T=async()=>{r.value||("全部"===i.value&&v++,"待指派"===i.value&&d++,"待处置"===i.value&&c++,"待审核"===i.value&&p++,"处置完成"===i.value&&m++,"无需处置"===i.value&&g++,y())},j=async()=>{r.value=!1,$.value=I.value,b.value=S.startDate,N.value=S.endDate,q(i.value),n.value.close()};function x(e){let a=e.detail.value;f.value=D.value[a],I.value=w.value[a]}const A=e=>{const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0"),String(e.getSeconds()).padStart(2,"0"),`${a}-${t}-${l}`},k=e=>{let a,t;_.value=e;const l=new Date;switch(e){case"lastDay":const e=new Date(l.getTime()-864e5);a=A(e),t=A(l);break;case"lastMonths":const s=new Date;s.setMonth(l.getMonth()-1),a=A(s),t=A(l);break;case"All":a=t=null;default:a=t=null}S.startDate=a,S.endDate=t};let M="",C="";const F=a=>{M=a.detail.value;let t=new Date(M),l=new Date(C);t>=l&&l?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),S.startDate="",M=""):S.startDate=M},V=a=>{C=a.detail.value;let t=new Date(M);t>=new Date(C)&&t?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),S.endDate="",C=""):S.endDate=C},B=()=>{S.startDate="",S.endDate="",M="",C="",_.value="All",f.value="全部",I.value=""};function P(e,a){i.value=e,o.value=a,r.value=!1,q(i.value)}function q(e){"全部"===e&&(v=1),"待指派"===e&&(d=1),"待处置"===e&&(c=1),"待审核"===e&&(p=1),"处置完成"===e&&(m=1),"无需处置"===e&&(g=1),u.value="",y()}const E={0:"#F56C6C",1:"#FFAF41",2:"#61D19F",3:"#9CABCB",4:"#00ADB5"},H=()=>{e.index.navigateBack()};function z(a){e.index.navigateTo({url:"/pages/hiddenTrouble/subHiddenTrouble?id="+a})}function G(){n.value.open()}return(async()=>{let e=await t.apiGetSceneName({projectId:l.PROJECTID.globalProjectId});h.value=e.data.children,h.value.forEach((e=>{e.children.length>0&&e.children.forEach((e=>{e.sceneName&&e.sceneId&&(D.value.push(e.sceneName),w.value.push(e.sceneId))}))}))})(),e.onUnload((()=>{e.index.removeStorageSync("hiddenDangerList")})),(t,l)=>e.e({a:a._imports_0$4,b:e.o(H),c:a._imports_1$3,d:e.o(G),e:"view1"===o.value?1:"",f:e.o((e=>P("全部","view1"))),g:"view2"===o.value?1:"",h:e.o((e=>P("待指派","view2"))),i:"view3"===o.value?1:"",j:e.o((e=>P("待处置","view3"))),k:"view4"===o.value?1:"",l:e.o((e=>P("待审核","view4"))),m:"view5"===o.value?1:"",n:e.o((e=>P("处置完成","view5"))),o:"view6"===o.value?1:"",p:e.o((e=>P("无需处置","view6"))),q:"全部"===i.value},"全部"===i.value?e.e({r:u.value.length>0},u.value.length>0?{s:e.f(u.value,((a,t,l)=>{return e.e({a:e.t(a.sceneName),b:e.t(a.disposerName),c:e.t(a.disposalTime),d:"0"===a.state},("0"===a.state||"1"===a.state||"2"===a.state||"3"===a.state||a.state,{}),{e:"1"===a.state,f:"2"===a.state,g:"3"===a.state,h:"4"===a.state,i:(s=a.state,E[s]||"black"),j:e.t(a.dailyInspectionItemValue),k:a.id,l:e.o((e=>z(a.id)),a.id)});var s})),t:a._imports_2$1,v:a._imports_1$8,w:e.o(T)}:{x:a._imports_2$9}):{},{y:"待指派"===i.value},"待指派"===i.value?e.e({z:u.value.length>0},u.value.length>0?{A:e.f(u.value,((t,l,s)=>e.e({a:"0"===t.state},"0"===t.state?{b:a._imports_2$1,c:e.t(t.sceneName),d:e.t(t.disposerName),e:e.t(t.disposalTime),f:a._imports_1$8,g:e.t(t.dailyInspectionItemValue)}:{},{h:t.id,i:e.o((e=>z(t.id)),t.id)}))),B:e.o(T)}:{C:a._imports_2$9}):{},{D:"待处置"===i.value},"待处置"===i.value?e.e({E:u.value.length>0},u.value.length>0?{F:e.f(u.value,((t,l,s)=>e.e({a:"1"===t.state},"1"===t.state?{b:a._imports_2$1,c:e.t(t.sceneName),d:e.t(t.disposerName),e:e.t(t.disposalTime),f:a._imports_1$8,g:e.t(t.dailyInspectionItemValue)}:{},{h:t.id,i:e.o((e=>z(t.id)),t.id)}))),G:e.o(T)}:{H:a._imports_2$9}):{},{I:"待审核"===i.value},"待审核"===i.value?e.e({J:u.value.length>0},u.value.length>0?{K:e.f(u.value,((t,l,s)=>e.e({a:"4"===t.state},"4"===t.state?{b:a._imports_2$1,c:e.t(t.sceneName),d:e.t(t.disposerName),e:e.t(t.disposalTime),f:a._imports_1$8,g:e.t(t.dailyInspectionItemValue)}:{},{h:t.id,i:e.o((e=>z(t.id)),t.id)}))),L:e.o(T)}:{M:a._imports_2$9}):{},{N:"处置完成"===i.value},"处置完成"===i.value?e.e({O:u.value.length>0},u.value.length>0?{P:e.f(u.value,((t,l,s)=>e.e({a:"2"===t.state},"2"===t.state?{b:a._imports_2$1,c:e.t(t.sceneName),d:e.t(t.disposerName),e:e.t(t.disposalTime),f:a._imports_1$8,g:e.t(t.dailyInspectionItemValue)}:{},{h:t.id,i:e.o((e=>z(t.id)),t.id)}))),Q:e.o(T)}:{R:a._imports_2$9}):{},{S:"无需处置"===i.value},"无需处置"===i.value?e.e({T:u.value.length>0},u.value.length>0?{U:e.f(u.value,((t,l,s)=>e.e({a:"3"===t.state},"3"===t.state?{b:a._imports_2$1,c:e.t(t.sceneName),d:e.t(t.disposerName),e:e.t(t.disposalTime),f:a._imports_1$8,g:e.t(t.dailyInspectionItemValue)}:{},{h:t.id,i:e.o((e=>z(t.id)),t.id)}))),V:e.o(T)}:{W:a._imports_2$9}):{},{X:"All"===_.value?1:"",Y:e.o((e=>k("All"))),Z:"lastDay"===_.value?1:"",aa:e.o((e=>k("lastDay"))),ab:"lastMonths"===_.value?1:"",ac:e.o((e=>k("lastMonths"))),ad:S.startDate,ae:e.o((e=>S.startDate=e.detail.value)),af:e.o(F),ag:S.endDate,ah:e.o((e=>S.endDate=e.detail.value)),ai:e.o(V),aj:e.t(e.unref(f)),ak:D.value,al:e.o(x),am:e.o(B),an:e.o(j),ao:e.sr(n,"9489a9bf-0",{k:"popupBottom"}),ap:e.p({type:"bottom","border-radius":"30rpx 30rpx 0 0","background-color":"#fff"})})}},i=e._export_sfc(s,[["__scopeId","data-v-9489a9bf"]]);wx.createPage(i);
