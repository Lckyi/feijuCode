"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),n=require("../../config.js");if(!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"alarmPush",setup(o){const l=e.ref(null),r=e.ref([]),s=e.ref(null);e.ref(!1);const u=e.ref(null),i=e.ref(null),m=e.reactive({startDate:"",endDate:""});e.onShow((()=>{e.index.$on("devName",(e=>{e&&(u.value=e)}))}));const d=async()=>{r.value="",c(),l.value.close()},c=async()=>{let a;const o={projectId:n.PROJECTID.globalProjectId,alarmState:1};m.startDate&&m.endDate&&(o.startTime=m.startDate,o.endTime=m.endDate),u.value&&(o.deviceName=u.value),a=await t.apiGetRealTimeAlarm(o);const l=function(e,a=[]){for(let t in e)Array.isArray(e[t])&&e[t].forEach((e=>{"object"==typeof e&&null!==e&&a.push(e)}));return a}(a.data);r.value=[...r.value,...l],e.index.setStorageSync("alarmList",r.value)};const p=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`,v=e=>{let a,t;i.value=e;const n=new Date;switch(e){case"lastMonth":const e=new Date;e.setMonth(n.getMonth()-1),a=p(e),t=p(n);break;case"lastThreeMonths":const o=new Date;o.setMonth(n.getMonth()-3),a=p(o),t=p(n);break;case"lastSixMonths":const l=new Date;l.setMonth(n.getMonth()-6),a=p(l),t=p(n);break;default:a=t=null}m.startDate=a,m.endDate=t},h=e.ref(""),D=a=>{let t=new Date(h.value),n=new Date(f.value);t>=n&&n?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),m.startDate=""):m.startDate=h.value},f=e.ref(""),g=a=>{let t=new Date(h.value);t>=new Date(f.value)&&t?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),m.endDate=""):m.endDate=f.value},S=()=>{m.startDate="",m.endDate="",i.value="",u.value="",f.value="",h.value=""},_=()=>{e.index.navigateBack()};function M(){l.value.open()}function x(){e.index.navigateTo({url:"/pages/alarmPush/search?flag=alarmPush"})}return c(),e.onUnload((()=>{e.index.removeStorageSync("alarmList")})),(t,n)=>e.e({a:a._imports_0$4,b:e.o(_),c:a._imports_1$3,d:e.o(M),e:r.value.length>0},r.value.length>0?{f:e.f(r.value,((t,n,o)=>e.e({a:e.t(t.deviceName),b:1===t.alarmLevel},(t.alarmLevel,{}),{c:2===t.alarmLevel},(t.alarmLevel,{}),{d:e.t(t.alarmTime),e:1===t.alarmLevel},1===t.alarmLevel?{f:e.t(t.alarmContent)}:{g:e.t(t.alarmContent)},{h:1===t.alarmLevel},1===t.alarmLevel?{i:e.t(t.alarmValue),j:e.t(t.unit)}:{k:e.t(t.alarmValue),l:e.t(t.unit)},{m:0===t.alarmState},0===t.alarmState?{n:a._imports_2$6}:{},{o:1===t.alarmState},1===t.alarmState?{p:a._imports_3$3}:{},{q:e.o((a=>{return n=t.alarmId,void e.index.navigateTo({url:"/pages/alarmPush/alarmDetails?alarmId="+n});var n}),t.alarmId),r:t.alarmId}))),g:a._imports_1$2,h:e.p({status:s.value}),i:e.o(((...e)=>t.bottomRefresh&&t.bottomRefresh(...e)))}:{j:a._imports_4$1},{k:"lastMonth"===i.value?1:"",l:e.o((e=>v("lastMonth"))),m:"lastThreeMonths"===i.value?1:"",n:e.o((e=>v("lastThreeMonths"))),o:"lastSixMonths"===i.value?1:"",p:e.o((e=>v("lastSixMonths"))),q:m.startDate,r:e.o((e=>m.startDate=e.detail.value)),s:e.o(D),t:e.o((e=>h.value=e)),v:e.p({type:"datetime",modelValue:h.value}),w:m.endDate,x:e.o((e=>m.endDate=e.detail.value)),y:e.o(g),z:e.o((e=>f.value=e)),A:e.p({type:"datetime","min-date":h.value,modelValue:f.value}),B:e.p({type:"search",size:"26",color:"#DDE4EF"}),C:u.value,D:e.o((e=>u.value=e.detail.value)),E:e.o(x),F:e.o(S),G:e.o(d),H:e.sr(l,"f3d21cb8-1",{k:"popup"}),I:e.p({type:"bottom","border-radius":"16rpx 16rpx 0 0","background-color":"#fff","safe-area":!0})})}},l=e._export_sfc(o,[["__scopeId","data-v-f3d21cb8"]]);wx.createPage(l);
