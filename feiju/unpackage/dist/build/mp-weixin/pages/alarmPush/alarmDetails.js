"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),r=require("../../config.js");if(!Array){e.resolveComponent("qiun-data-charts")()}Math;const o={__name:"alarmDetails",setup(o){const l=e.ref("content1"),i=e.ref("view1"),n=e.ref([]),s=e.ref({}),c=e.ref(""),u=e.ref([]),v={deviceId:"",types:"",startTime:"",endTime:""};e.onLoad((e=>{c.value=e.alarmId})),e.onMounted((()=>{d()}));const m=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`,d=async()=>{let e=await t.apiGetAlarmRecords({projectId:r.PROJECTID.globalProjectId,alarmId:c.value});u.value=e.rows,v.deviceId=u.value[0].deviceNumber,v.types=u.value[0].dataId;let a=new Date(u.value[0].alarmTime),o="";o=u.value[0].alarmRecoverTime?new Date(u.value[0].alarmRecoverTime):new Date(u.value[0].alarmTime),a.setHours(a.getHours()-1),o.setHours(o.getHours()+1),v.startTime=m(a),v.endTime=m(o),await f(v)},p=e.ref({color:["#1890FF"],padding:[15,15,0,15],enableScroll:!1,legend:{},xAxis:{disableGrid:!0},yAxis:{gridType:"dash",dashLength:2},extra:{area:{type:"curve",opacity:.8,addLine:!0,width:2,gradient:!0,activeType:"hollow"}}});function g(){f(v)}const f=async a=>{try{let r=await t.apiGetChart(a);if(!r.data[0].time||!r.data[0].valueOne)return void console.error("没有图表数据");n.value=r.data;n.value[0].valueOne;const o=function(a,t){const r=e.reactive({categories:"",data:"",showData:""}),o=e.ref([]);r.categories=a.slice(-6),r.data=t.slice(-6);for(const e in r.categories)if(r.categories.hasOwnProperty(e)){const[a,t]=r.categories[e].split(" "),l=t.slice(0,5);o.value.push(l)}return r.showData=o.value,r}(n.value[0].time,n.value[0].valueOne);setTimeout((()=>{s.value={categories:o.showData,series:[{name:n.value[0].typeName,data:o.data}]}}),500)}catch(r){console.error("暂无图标数据",r)}};const h=()=>{e.index.navigateBack()};function w(e,a){l.value=e,i.value=a}return(t,r)=>e.e({a:a._imports_0$4,b:e.o(h),c:a._imports_1$5,d:"view1"===i.value?1:"",e:e.o((e=>w("content1","view1"))),f:"view2"===i.value?1:"",g:e.o((e=>w("content2","view2"))),h:e.f(u.value,((t,r,o)=>"content1"===l.value?e.e({a:e.t(t.alarmTime),b:2===t.alarmLevel},(t.alarmLevel,{}),{c:1===t.alarmLevel},(t.alarmLevel,{}),{d:e.t(t.alarmContent),e:e.t(t.alarmValue),f:e.t(t.unit),g:0===t.alarmState},0===t.alarmState?{h:e.t(t.alarmRecoverTime)}:{},{i:0===t.alarmState},0===t.alarmState?{j:a._imports_2$6}:{},{k:1===t.alarmState},1===t.alarmState?{l:a._imports_3$3}:{},{m:e.t(t.alarmContent)}):"content2"===l.value?{n:e.t(t.deviceName),o:e.t(t.deviceNumber),p:e.t(t.deviceAddress)}:{})),i:"content1"===l.value,j:"content2"===l.value,k:a._imports_4$3,l:e.o(g),m:n.value.length>0},n.value.length>0?{n:e.p({type:"area",opts:p.value,chartData:s.value})}:{o:a._imports_4$1})}},l=e._export_sfc(o,[["__scopeId","data-v-7f021e73"]]);wx.createPage(l);
