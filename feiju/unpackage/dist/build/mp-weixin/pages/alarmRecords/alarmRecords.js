"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/apis.js"),n=require("../../config.js");if(!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"alarmRecords",setup(o){const l=e.ref(null),r=e.ref([]),s=e.ref(null),u=e.ref(!1),i=e.ref(null),m=e.ref(null);let d=1;const v=e.reactive({startDate:"",endDate:""});e.onShow((()=>{e.index.$on("devName",(e=>{e&&(i.value=e,console.log(i.value))}))}));const p=async()=>{r.value="",d=1,g(),u.value=!1,l.value.close()},c=async()=>{u.value||(d++,g())},g=async()=>{let a;const o={projectId:n.PROJECTID.globalProjectId,pageNum:d,pageSize:10};v.startDate&&v.endDate&&(o.startTime=v.startDate,o.endTime=v.endDate),i.value&&(o.deviceName=i.value),a=await t.apiGetAlarmRecords(o),r.value=[...r.value,...a.rows],o.pageSize>a.rows.length&&(u.value=!0),e.index.setStorageSync("alarmList",r.value)},h=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`,D=e=>{let a,t;m.value=e;const n=new Date;switch(e){case"lastMonth":const e=new Date;e.setMonth(n.getMonth()-1),a=h(e),t=h(n);break;case"lastThreeMonths":const o=new Date;o.setMonth(n.getMonth()-3),a=h(o),t=h(n);break;case"lastSixMonths":const l=new Date;l.setMonth(n.getMonth()-6),a=h(l),t=h(n);break;default:a=t=null}v.startDate=a,v.endDate=t},S=e.ref(""),f=a=>{let t=new Date(S.value),n=new Date(_.value);t>=n&&n?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),v.startDate=""):v.startDate=S.value},_=e.ref(""),M=a=>{let t=new Date(S.value);t>=new Date(_.value)&&t?(e.index.showToast({title:"起始日期需小于结束日期",icon:"none",duration:2e3}),v.endDate=""):v.endDate=_.value},w=()=>{v.startDate="",v.endDate="",m.value="",i.value="",_.value="",S.value=""},x=()=>{e.index.navigateBack()};function $(){l.value.open()}function j(){e.index.navigateTo({url:"/pages/alarmPush/search?flag=alarmRecord"})}return g(),e.onUnload((()=>{e.index.removeStorageSync("alarmList")})),(t,n)=>e.e({a:a._imports_0$4,b:e.o(x),c:a._imports_1$3,d:e.o($),e:r.value.length>0},r.value.length>0?{f:e.f(r.value,((t,n,o)=>e.e({a:e.t(t.deviceName),b:1===t.alarmLevel},(t.alarmLevel,{}),{c:2===t.alarmLevel},(t.alarmLevel,{}),{d:e.t(t.alarmTime),e:1===t.alarmLevel},1===t.alarmLevel?{f:e.t(t.alarmContent)}:{g:e.t(t.alarmContent)},{h:1===t.alarmLevel},1===t.alarmLevel?{i:e.t(t.alarmValue),j:e.t(t.unit)}:{k:e.t(t.alarmValue),l:e.t(t.unit)},{m:0===t.alarmState},0===t.alarmState?{n:a._imports_2$6}:{},{o:1===t.alarmState},1===t.alarmState?{p:a._imports_3$3}:{},{q:e.o((a=>{return n=t.alarmId,void e.index.navigateTo({url:"/pages/alarmPush/alarmDetails?alarmId="+n});var n}),t.alarmId),r:t.alarmId}))),g:a._imports_1$2,h:e.p({status:s.value}),i:e.o(c)}:{j:a._imports_4$1},{k:"lastMonth"===m.value?1:"",l:e.o((e=>D("lastMonth"))),m:"lastThreeMonths"===m.value?1:"",n:e.o((e=>D("lastThreeMonths"))),o:"lastSixMonths"===m.value?1:"",p:e.o((e=>D("lastSixMonths"))),q:v.startDate,r:e.o((e=>v.startDate=e.detail.value)),s:e.o(f),t:e.o((e=>S.value=e)),v:e.p({type:"datetime",modelValue:S.value}),w:v.endDate,x:e.o((e=>v.endDate=e.detail.value)),y:e.o(M),z:e.o((e=>_.value=e)),A:e.p({type:"datetime","min-date":S.value,modelValue:_.value}),B:e.p({type:"search",size:"26",color:"#DDE4EF"}),C:i.value,D:e.o((e=>i.value=e.detail.value)),E:e.o(j),F:e.o(w),G:e.o(p),H:e.sr(l,"474df485-1",{k:"popup"}),I:e.p({type:"bottom","border-radius":"16rpx 16rpx 0 0","background-color":"#fff","safe-area":!0})})}},l=e._export_sfc(o,[["__scopeId","data-v-474df485"]]);wx.createPage(l);
