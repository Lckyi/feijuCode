"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../utils/rsa.js"),n=require("../../config.js"),o={__name:"login",setup(o){const s=e.ref(""),r=e.ref(""),i=e.ref("");let u=e.ref("");const l=e.ref(!1),c=e.ref(!1);function d(){l.value=!l.value}function v(){c.value=!c.value}e.onMounted((()=>{const a=e.index.getStorageSync("autoLogin"),t=e.index.getStorageSync("username"),n=e.index.getStorageSync("password");t&&n&&(s.value=t,r.value=n,l.value=!0),c.value=!!a}));const S=async()=>{if(s.value)if(r.value)try{const a=await e.index.request({url:n.BASE_URL+"/publicKey",method:"GET"});i.value=a.data.publicKey,e.index.setStorageSync("publicKey",i.value),u=t.rsaEncrypt(r.value,i.value);const o=await e.index.request({url:n.BASE_URL+"/login",method:"POST",data:{username:s.value,password:u}});if(200===o.data.code){const a=o.data.token;e.index.setStorageSync("token",a),l.value?(e.index.setStorageSync("username",s.value),e.index.setStorageSync("password",r.value)):(e.index.removeStorageSync("username"),e.index.removeStorageSync("password")),c.value?(e.index.setStorageSync("autoLogin",c.value),e.index.setStorageSync("username",s.value),e.index.setStorageSync("password",r.value)):e.index.removeStorageSync("autoLogin"),e.index.showToast({title:"登录成功",icon:"success"}),e.index.switchTab({url:"/pages/index/index"})}else e.index.showToast({title:"登录失败："+o.data.msg,icon:"none"})}catch(a){console.error("登录请求失败：",a),e.index.showToast({title:"网络错误",icon:"none"})}else g("请输入密码");else g("请输入账号")};function g(a){e.index.showToast({title:a,icon:"none",duration:2e3})}return(t,n)=>({a:a._imports_0,b:a._imports_1,c:a._imports_2,d:s.value,e:e.o((e=>s.value=e.detail.value)),f:a._imports_3,g:r.value,h:e.o((e=>r.value=e.detail.value)),i:l.value,j:e.o(d),k:c.value,l:e.o(v),m:a._imports_4,n:e.o(S)})}},s=e._export_sfc(o,[["__scopeId","data-v-02381869"]]);wx.createPage(s);
